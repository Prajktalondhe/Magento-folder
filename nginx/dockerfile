FROM nginx:latest

# Create user and group to match Magento file ownership
RUN groupadd -g 1000 clp && \
    useradd -m -u 1000 -g clp test-ssh

# Replace default nginx user to test-ssh in nginx.conf
# We'll copy custom config that includes 'user test-ssh clp;'

# Copy custom nginx config file
COPY default.conf /etc/nginx/conf.d/default.conf

# Copy main nginx.conf to set user 
COPY nginx.conf /etc/nginx/nginx.conf

# Ensure permissions 
RUN chown -R test-ssh:clp /var/cache/nginx /var/log/nginx

USER test-ssh

EXPOSE 80 443

CMD ["nginx", "-g", "daemon off;"]
